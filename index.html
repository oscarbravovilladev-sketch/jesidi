<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <title>JdM - poc - IOT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: sans-serif;
    }

    p {
      margin: 10px;
      position: absolute;
      top: 0;
      z-index: 10;
      background: rgba(250, 250, 250, 0.7);
      padding: 5px;
      border-radius: 5px;
      pointer-events: none;
    }

    span {
      padding-right: 16px;
      font-size: 14px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.11.7/lib/p5.js"></script>
</head>

<body>
  <p id="display"></p>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <script>
    const targets = {}; 
    const display = document.querySelector('p');
    const clientId = "js_client_" + Math.random().toString(16).substr(2, 8);
    const client = mqtt.connect("wss://broker.hivemq.com:8884/mqtt", {
      clientId: clientId,
      clean: true
    });

    client.on("connect", () => client.subscribe("JESIDI-IOT-POC-200574"));
    client.on("message", (_t, payload) => {
      try {
        const j = JSON.parse(payload.toString());
      
        targets[j.id] = j;
        display.innerHTML = Object.values(targets).map(t => `
          <div>
            <strong>ID ${t.id}:</strong> 
            <span>X:${t.x} Y:${t.y}</span>
            <span>Distancia: ${t.dist}mm</span>
            <span>Angulo: ${t.ang}m/s</span>
            <span>Zona: ${t.zona} </span>
            <span>Distancia: ${t.dist}</span>
            <span>Grados: ${t.temp}Â°C</span>
            <span>Humedad: ${t.hum} HR</span
          </div>
        `).join('');
        console.log(j)
      } catch (e) { console.error("Error MQTT:", e); }
    });
  </script>
</body>

</html>
